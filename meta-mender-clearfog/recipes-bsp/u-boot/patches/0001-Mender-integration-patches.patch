From 88cd2f9de4e25fb99af8fc9028c21b25ed6d74fd Mon Sep 17 00:00:00 2001
From: Wayne Adams <wadams@davey.com.au>
Date: Tue, 22 Oct 2019 07:29:44 +1100
Subject: [PATCH] Mender integration patches

---
 configs/clearfog_defconfig      | 7 ++++++-
 include/config_defaults.h       | 6 ++++++
 include/config_distro_bootcmd.h | 1 -
 include/configs/clearfog.h      | 9 ---------
 4 files changed, 12 insertions(+), 11 deletions(-)

diff --git a/configs/clearfog_defconfig b/configs/clearfog_defconfig
index ebfe3cf158..7518684917 100644
--- a/configs/clearfog_defconfig
+++ b/configs/clearfog_defconfig
@@ -40,7 +40,6 @@ CONFIG_CMD_CACHE=y
 CONFIG_CMD_TIME=y
 # CONFIG_SPL_PARTITION_UUIDS is not set
 CONFIG_DEFAULT_DEVICE_TREE="armada-388-clearfog"
-CONFIG_ENV_IS_IN_MMC=y
 CONFIG_NET_RANDOM_ETHADDR=y
 CONFIG_SPL_OF_TRANSLATE=y
 CONFIG_AHCI_MVEBU=y
@@ -70,3 +69,9 @@ CONFIG_KIRKWOOD_SPI=y
 CONFIG_USB=y
 CONFIG_DM_USB=y
 CONFIG_USB_XHCI_HCD=y
+CONFIG_MMC=y
+CONFIG_ENV_IS_IN_MMC=y
+CONFIG_CMD_EXT4=y
+CONFIG_CMD_FS_GENERIC=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
\ No newline at end of file
diff --git a/include/config_defaults.h b/include/config_defaults.h
index d211a41ef2..b7893fb7e7 100644
--- a/include/config_defaults.h
+++ b/include/config_defaults.h
@@ -10,3 +10,9 @@
 #define _CONFIG_DEFAULTS_H_
 
 #endif
+
+#define CONFIG_ENV_SIZE 0x20000
+#define CONFIG_ENV_OFFSET 0x800000
+#define CONFIG_ENV_OFFSET_REDUND 0x1000000
+#define CONFIG_SYS_MMC_ENV_DEV 0
+#define CONFIG_SYS_MMC_ENV_PART 0
\ No newline at end of file
diff --git a/include/config_distro_bootcmd.h b/include/config_distro_bootcmd.h
index 3570a32dff..20e9dc1bea 100644
--- a/include/config_distro_bootcmd.h
+++ b/include/config_distro_bootcmd.h
@@ -485,7 +485,6 @@
 		"done\0"
 
 #ifndef CONFIG_BOOTCOMMAND
-#define CONFIG_BOOTCOMMAND "run distro_bootcmd"
 #endif
 
 #endif  /* _CONFIG_CMD_DISTRO_BOOTCMD_H */
diff --git a/include/configs/clearfog.h b/include/configs/clearfog.h
index 5f08349929..2f24b9379c 100644
--- a/include/configs/clearfog.h
+++ b/include/configs/clearfog.h
@@ -17,12 +17,6 @@
  */
 #define CONFIG_SYS_TCLK		250000000	/* 250MHz */
 
-/*
- * Extra configuration for Mender integration
- */
-#define CONFIG_BOOTCOUNT_LIMIT
-#define CONFIG_BOOTCOUNT_ENV
-
 /*
  * Commands configuration
  */
@@ -38,16 +32,13 @@
 #define CONFIG_ENV_MIN_ENTRIES		128
 
 /* Environment in MMC */
-#define CONFIG_SYS_MMC_ENV_DEV		0
 #define CONFIG_ENV_SECT_SIZE		0x200
-#define CONFIG_ENV_SIZE			0x10000
 /*
  * For SD - reserve 1 LBA for MBR + 1M for u-boot image. The MMC/eMMC
  * boot image starts @ LBA-0.
  * As result in MMC/eMMC case it will be a 1 sector gap between u-boot
  * image and environment
  */
-#define CONFIG_ENV_OFFSET		0xf0000
 #define CONFIG_ENV_ADDR			CONFIG_ENV_OFFSET
 
 #define PHY_ANEG_TIMEOUT	8000	/* PHY needs a longer aneg time */
-- 
2.23.0.windows.1

